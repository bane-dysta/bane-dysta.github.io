---
title: Study notesï¼šdocker
date: 2025-3-31 12:00:00 +0800
categories: [note]
tags: [note,docker]   
---
ç¬”è€…è™½ç„¶å†™è¿‡ä¸€å †æ—¶å°šå°åƒåœ¾ï¼Œè¿˜å†™äº†åƒæ¨¡åƒæ ·çš„READMEæ–‡æ¡£ï¼Œä½†å®é™…ä¸Šç¬”è€…åªæ˜¯å€ŸClaude3.5ç‹å‡è™å¨ï¼Œè‡ªå·±åŸºæœ¬ä¸ä¼šå•¥ä»£ç ã€‚æ‰€ä»¥ï¼Œè¿™ç¯‡Noteæ˜¯ä¸ºæˆ‘è‡ªå·±æ¢³ç†dockerçš„ç»“æ„ï¼Œä»¥ä¾¿äºæ›´å¥½åœ°ä½œä¸ºç”²æ–¹å‘Claudeæè¦æ±‚ç”¨çš„ï¼Œé‡Œé¢è®°å½•çš„ä¸œè¥¿å¯¹å„ä½è¯»è€…å¤§èƒ½æ¥è¯´ä¼°è®¡æ²¡ä»€ä¹ˆç”¨ğŸ˜¸çœ‹ä¸ªä¹å­å§ã€‚
# Dockerç®€ä»‹

Dockeræ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨åŒ–å¹³å°ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿå°†åº”ç”¨ç¨‹åºåŠå…¶ä¾èµ–é¡¹æ‰“åŒ…åˆ°ä¸€ä¸ªå¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œä»¥ç¡®ä¿åº”ç”¨åœ¨ä»»ä½•ç¯å¢ƒä¸­éƒ½èƒ½ä¸€è‡´è¿è¡Œã€‚

## Dockerçš„æ ¸å¿ƒæ¦‚å¿µ

- **é•œåƒ**ï¼šä¸€ä¸ªç‹¬ç«‹çš„åŒ…å«é¡¹ç›®æ‰€æœ‰è¿è¡Œä¾èµ–çš„åªè¯»è½¯ä»¶åŒ…ï¼Œåœ¨æ„å»ºæ—¶å¯ä»¥é€šè¿‡å„ç§å®‰è£…å‘½ä»¤(å¦‚aptã€pipç­‰)å‘é‡Œé¢æ·»åŠ packageï¼Œä½¿å¾—é¡¹ç›®å¯ä»¥å®Œå…¨ä¾èµ–è¿™ä¸ªç¯å¢ƒæ¥è¿è¡Œã€‚é•œåƒå¯ä»¥è‡ªå·±æ„å»ºï¼Œä¹Ÿ*å¯ä»¥?*ä»Docker Hubæ‹‰å–ã€‚
- **Dockerfile**ï¼šæ„å»ºé•œåƒçš„è„šæœ¬ã€‚æˆ‘çš„ä¸€ä¸ªç”¨äºNASåŒæ­¥è¿œç¨‹æœåŠ¡å™¨ä¸Šè®¡ç®—åŒ–å­¦æ•°æ®é¡¹ç›®çš„Dockerfileå¦‚ä¸‹ï¼š
  ```
  FROM python:3.9-slim # é€šå¸¸ä½¿ç”¨è½»é‡çº§pythonç¯å¢ƒä¸ºåŸºç¡€æ„å»ºdocker

  WORKDIR /app # è®¾ç½®å·¥ä½œç›®å½•
  
  # RUNè¡¨ç¤ºå®‰è£…è¿›dockeré•œåƒï¼Œæ­¤å¤„å…ˆä½¿ç”¨aptæ¥å®‰è£…æ‰€éœ€çš„åŒ…ã€‚ä¾‹å¦‚ï¼Œæ ¸å¿ƒrsyncï¼ŒåŒæ­¥æ—¶éœ€è¦çš„opensshï¼Œé€‚åº”è¿œç¨‹ä¸­æ–‡ç›®å½•çš„localesç­‰
  RUN apt-get update && \
      apt-get install -y rsync openssh-client locales procps && \
      sed -i -e 's/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/' /etc/locale.gen && \
      sed -i -e 's/# zh_CN.UTF-8 UTF-8/zh_CN.UTF-8 UTF-8/' /etc/locale.gen && \
      locale-gen && \
      apt-get clean && rm -rf /var/lib/apt/lists/* && \
      ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && \
      echo "Asia/Shanghai" > /etc/timezone
  #å®‰è£…å®Œæ¯•åä½¿ç”¨apt-get cleanåˆ é™¤ä¸å†éœ€è¦çš„ç¼“å­˜ï¼Œä»¥å‡å°dockeré•œåƒä½“ç§¯

  # è®¾ç½®ç¯å¢ƒå˜é‡
  ENV LANG=zh_CN.UTF-8
  ENV LC_ALL=zh_CN.UTF-8
  
  # åˆ›å»ºé¡¹ç›®ç›®å½•
  RUN mkdir -p /app/keys /app/sync_data /app/templates /app/Orb_Viewer
  
  # å¤åˆ¶é¡¹ç›®æ–‡ä»¶åˆ°é•œåƒå†…
  COPY app.py requirements.txt /app/
  COPY templates /app/templates/
  COPY Orb_Viewer /app/Orb_Viewer/
  
  # ä½¿ç”¨pipå‘dockerå†…å®‰è£…pythonåŒ…
  RUN pip install --no-cache-dir -i https://pypi.tuna.tsinghua.edu.cn/simple --trusted-host pypi.tuna.tsinghua.edu.cn -r requirements.txt || \
      pip install --no-cache-dir -r requirements.txt
  
  # è®¾ç½®ç¯å¢ƒå˜é‡
  ENV FLASK_APP=app.py
  ENV FLASK_ENV=production
  
  # ä¸ºäº†ä¿å­˜åŒæ­¥ä¸‹æ¥çš„æ•°æ®ï¼Œè¿›è¡Œå·æŒ‚è½½
  VOLUME ["/app/sync_data", "/app/keys"]
  
  # å¦‚æœ‰webæœåŠ¡ï¼Œå¯ä»¥å¯¹å¤–æš´éœ²ç«¯å£
  EXPOSE 5001 5011
  
  # åº”ç”¨å…¥å£ï¼Œå¤§è‡´è¡¨ç¤ºå¯åŠ¨é•œåƒæ—¶è¯¥è¿è¡Œä»€ä¹ˆå‘½ä»¤
  CMD ["python", "app.py"]
  ```

- **å®¹å™¨**ï¼šæ˜¯é•œåƒçš„è¿è¡Œè½½ä½“ï¼Œè¿è¡Œæ—¶é€šå¸¸ä¸æ”¹å˜é•œåƒå†…å®¹ã€‚å®¹å™¨å†…çš„æ–‡ä»¶é™¤éåšæ°¸ä¹…åŒ–ï¼Œå¦åˆ™æ˜¯ä¸´æ—¶çš„ã€‚

åœ¨æ‰“åŒ…å®Œæˆåï¼Œdockeré•œåƒå¯ä»¥è½»æ¾ç§»æ¤åˆ°å„ç§å¹³å°ä½¿ç”¨ï¼Œè€Œæ— éœ€æ‹…å¿ƒç¯å¢ƒé—®é¢˜ã€‚åŒæ—¶ï¼ŒNASæœåŠ¡å™¨ä¸Šå…è®¸å¯¹dockerå®¹å™¨è¿›è¡Œè¿œç¨‹ç®¡ç†ï¼Œå¾ˆé€‚åˆç”¨æ¥éƒ¨ç½²ä¸€äº›webæœåŠ¡ã€‚

åŒæ—¶ï¼Œdockerä¹Ÿå¯ä»¥ç”¨æ¥ç®¡ç†å®¿ä¸»æœºçš„ç¯å¢ƒï¼Œä½¿ç”¨å·æŒ‚è½½å…è®¸å®¹å™¨å†…çš„ç¨‹åºå¤„ç†å®¿ä¸»æœºçš„æ–‡ä»¶ï¼Œå¹¶å°†ç»“æœå†™å›å®¿ä¸»æœºã€‚

## DockeråŸºæœ¬å‘½ä»¤

```bash
# docker pullä»docker hubæ‹‰å–é•œåƒ
docker pull nginx 

# docker buildè‡ªå·±æ„å»ºé•œåƒ
sudo docker build -t rsync-sync-nas .

# docker runè¿è¡Œå®¹å™¨ 
# -pæ˜¯æ˜ å°„åˆ°å®¿ä¸»æœºçš„ç«¯å£è®¾ç½®
# -væ˜¯æ˜ å°„åˆ°å®¿ä¸»æœºçš„ç›®å½•è®¾ç½®
sudo docker run -d \
  --name rsync-sync \
  -p 5010:5001 \
  -p 5011:5011 \
  -v $(pwd)/sync_data:/app/sync_data \
  -v $(pwd)/templates:/app/templates \
  -v $(pwd)/app.py:/app/app.py \
  rsync-sync-nas

# docker psæŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨
docker ps
```
