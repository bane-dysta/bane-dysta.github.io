---
title: é‡å­åŒ–å­¦è½¯ä»¶BDFåœ¨ä½ç‰ˆæœ¬ç³»ç»Ÿä¸Šçš„è¿è¡Œæ–¹æ¡ˆ
date: 2025-7-31 12:00:00 +0800
categories: [Quantum Chemistry,BDF]  
---

## é—®é¢˜æè¿°

ç»ˆäºç”³è¯·åˆ°BDFçš„å­¦æœ¯ç‰ˆlicenseï¼Œè¿«ä¸åŠå¾…åœ°ä»dropboxä¸Šä¸‹è½½ä¸‹æ¥(å“‡å•Šå•Šå•Š1.3ä¸ªgè¿˜å¾—ä¿®ç»ƒè½»åŠŸ)è£…ä¸ŠæœåŠ¡å™¨ï¼Œç„¶åå°±çœ‹åˆ°äº†è¿™ä¸ªï¼š
```bash
/opt/sge/default/spool/s02/job_scripts/239: line 10: ulimit: max locked memory: cannot modify limit: Operation not permitted
/apps/bdf/bin/compass.x: error while loading shared libraries: libiomp5.so: cannot open shared object file: No such file or directory
Traceback (most recent call last):
  File "/apps/bdf/sbin/bdfdrv.py", line 362, in <module>
    main()
  File "/apps/bdf/sbin/bdfdrv.py", line 328, in main
    if not singlepoint(inpfile, BDFHOME, taskname, bdfmodules, outfile):
  File "/apps/bdf/sbin/bdfutil.py", line 669, in singlepoint
    re=bdf_exec(bdfmodule, finp, fout, True) #system(bdfcmd)
  File "/apps/bdf/sbin/bdfutil.py", line 1939, in bdf_exec
    re=check_module_result(bdfmodule)
  File "/apps/bdf/sbin/bdfutil.py", line 1154, in check_module_result
    fre = open(result,"r")
FileNotFoundError: [Errno 2] No such file or directory: './tmp/25560/nacme.returncode'
```
ä¸¢ç»™Claudeï¼Œä»–è¯´æ˜¯BDFè½¯ä»¶çš„compass.xç¨‹åºæ— æ³•æ‰¾åˆ°Intel OpenMPè¿è¡Œåº“ã€‚å—¯è¿™å¾ˆæ­£å¸¸ï¼Œç¬”è€…è¿™ä¸ªæœåŠ¡å™¨æ ¹æœ¬å°±æ²¡è£…oneapiã€‚å‡ ç»å‘¨æŠ˜è£…å¥½oneapiåï¼Œè¿™æ¬¡åˆçœ‹åˆ°äº†è¿™ä¸ªï¼š
```bash
/opt/sge/default/spool/s01/job_scripts/1293: line 10: ulimit: max locked memory: cannot modify limit: Operation not permitted
/apps/bdf/bin/compass.x: /lib64/libc.so.6: version `GLIBC_2.32' not found (required by /apps/bdf/bin/compass.x)
/apps/bdf/bin/compass.x: /lib64/libc.so.6: version `GLIBC_2.34' not found (required by /apps/bdf/bin/compass.x)
/apps/bdf/bin/compass.x: /lib64/libstdc++.so.6: version `GLIBCXX_3.4.29' not found (required by /apps/bdf/bin/compass.x)
/apps/bdf/bin/compass.x: /lib64/libstdc++.so.6: version `GLIBCXX_3.4.26' not found (required by /apps/bdf/bin/compass.x)
Traceback (most recent call last):
  File "/apps/bdf/sbin/bdfdrv.py", line 362, in <module>
    main()
  File "/apps/bdf/sbin/bdfdrv.py", line 328, in main
    if not singlepoint(inpfile, BDFHOME, taskname, bdfmodules, outfile):
  File "/apps/bdf/sbin/bdfutil.py", line 669, in singlepoint
    re=bdf_exec(bdfmodule, finp, fout, True) #system(bdfcmd)
  File "/apps/bdf/sbin/bdfutil.py", line 1939, in bdf_exec
    re=check_module_result(bdfmodule)
  File "/apps/bdf/sbin/bdfutil.py", line 1154, in check_module_result
    fre = open(result,"r")
FileNotFoundError: [Errno 2] No such file or directory: './tmp/26174/nacme.returncode'
```
è¿™æ¬¡ç¬”è€…éƒ½ä¸ç”¨ç»™Claudeçœ‹ã€‚`GLIBC_2.34`è¿™ä¸ªå¯æ¶çš„ä¸œè¥¿å±¡æ¬¡é˜»æ­¢ç¬”è€…åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œé¢„ç¼–è¯‘è½¯ä»¶è€Œä¸å¾—ä¸æ‰‹åŠ¨ç¼–è¯‘ï¼Œç¬”è€…å¯å¤ªç†Ÿæ‚‰äº†ã€‚

## è§£å†³æ–¹æ¡ˆ
æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š
- **1.å‡çº§glibc**
  
  è¿™ä¸ªæ–¹æ¡ˆç¬”è€…å¤§æ¦‚åœ¨å»å¹´è¿™ä¸ªæ—¶å€™åŠªåŠ›è¿‡ï¼Œä¸€å‘¨æ— æœã€‚åŸå› æ˜¯é‚£å°æœåŠ¡å™¨æ˜¯centOS 6.9ï¼Œæ— è®ºcmakeè¿˜æ˜¯gccè¿˜æ˜¯glibcéƒ½è€çš„è¦å‘½ã€‚è€Œè¿™äº›åä¸œè¥¿è¿˜æ˜¯ç¯ç¯ç›¸æ‰£çš„ï¼Œå¿…é¡»è½¬ç€åœˆèºæ—‹ç¼–è¯‘ï¼Œè¿™å¯¹å½“æ—¶è¿˜æ˜¯åˆå­¦è€…å¾—ç¬”è€…æ¥è¯´éš¾åº¦æœ‰ç‚¹é«˜äº†ã€‚è¿™ä¸ªå¿ƒç†é˜´å½±ä½¿å¾—ä»æ­¤ä»¥åç¬”è€…çœ‹è§è¿™è¦åŠ¨äº›ç©æ„çš„æ–¹æ¡ˆå…¨éƒ½ç»•é“èµ°ï¼Œè¿™æ¬¡ä¹Ÿä¸ä¾‹å¤–ã€‚
- **2.ä½¿ç”¨dockeræ‰“åŒ…**
  
  å¥½åœ¨æˆ‘ä»¬è¿˜æœ‰å¤‡é€‰æ–¹æ¡ˆâ€”â€”dockerã€‚åªè¦ä»¥ubuntu22ä¸ºèµ·ç‚¹æ„å»ºé•œåƒï¼Œä¸Šè¿°é—®é¢˜å…¨éƒ¨è¿åˆƒè€Œè§£ã€‚ç¼ºç‚¹å°±æ˜¯æ€§èƒ½ä¼šæœ‰ä¸€å®šæŸå¤±ï¼Œä½†ç¬”è€…ç›®å‰ä¸æ‰“ç®—ç”¨BDFè¿è¡Œä»€ä¹ˆå¾ˆé‡çš„è®¡ç®—ï¼Œæ‰€ä»¥ä¹Ÿå°±æ— æ‰€è°“äº†ã€‚

è‡ªå·±å†™dockerfileï¼Ÿå¼€ä»€ä¹ˆç©ç¬‘ï¼Œè¿™ç§æ´»å½“ç„¶æŒ‡ä½¿Claudeæ¥å¹²ğŸ˜¸
```Dockerfile
# BDF Dockerfile with Intel OneAPI support
FROM ubuntu:22.04

# é¿å…äº¤äº’å¼å®‰è£…
ENV DEBIAN_FRONTEND=noninteractive

# å®‰è£…åŸºç¡€ä¾èµ–
RUN apt-get update && apt-get install -y \
    build-essential \
    gfortran \
    wget \
    curl \
    python3 \
    python3-pip \
    cpio \
    sudo \
    && rm -rf /var/lib/apt/lists/*

# åˆ›å»ºå®‰è£…ç›®å½•
RUN mkdir -p /opt/intel/oneapi

# å¤åˆ¶Intel OneAPIå®‰è£…åŒ…
COPY oneapi/l_BaseKit_p_2024.2.1.100_offline.sh /tmp/
COPY oneapi/l_HPCKit_p_2024.2.1.79_offline.sh /tmp/

# å®‰è£…Intel OneAPI BaseKit (æ— ç•Œé¢å®‰è£…)
RUN chmod +x /tmp/l_BaseKit_p_2024.2.1.100_offline.sh && \
    /tmp/l_BaseKit_p_2024.2.1.100_offline.sh -a --silent --eula accept && \
    rm /tmp/l_BaseKit_p_2024.2.1.100_offline.sh

# å®‰è£…Intel OneAPI HPCKit (æ— ç•Œé¢å®‰è£…)  
RUN chmod +x /tmp/l_HPCKit_p_2024.2.1.79_offline.sh && \
    /tmp/l_HPCKit_p_2024.2.1.79_offline.sh -a --silent --eula accept && \
    rm /tmp/l_HPCKit_p_2024.2.1.79_offline.sh

# å¤åˆ¶BDFè½¯ä»¶
COPY bdf/ /apps/bdf/

# è®¾ç½®åŸºç¡€ç¯å¢ƒå˜é‡
ENV BDFHOME=/apps/bdf
ENV PATH=$BDFHOME/bin:$PATH
ENV LD_LIBRARY_PATH=$BDFHOME/lib:$LD_LIBRARY_PATH

# åˆ›å»ºBDFç”¨æˆ·
RUN useradd -m -s /bin/bash bdfuser && \
    chown -R bdfuser:bdfuser /apps/bdf/

# åˆ›å»ºå¯åŠ¨è„šæœ¬ï¼ŒåŒ…å«Intel OneAPIç¯å¢ƒè®¾ç½®
RUN echo '#!/bin/bash' > /usr/local/bin/bdf_env.sh && \
    echo '' >> /usr/local/bin/bdf_env.sh && \
    echo '# Source Intel OneAPI environment' >> /usr/local/bin/bdf_env.sh && \
    echo 'source /opt/intel/oneapi/setvars.sh --force' >> /usr/local/bin/bdf_env.sh && \
    echo '' >> /usr/local/bin/bdf_env.sh && \
    echo '# Set BDF environment' >> /usr/local/bin/bdf_env.sh && \
    echo 'export BDFHOME=/apps/bdf' >> /usr/local/bin/bdf_env.sh && \
    echo 'export LD_LIBRARY_PATH=/apps/bdf/lib:$LD_LIBRARY_PATH' >> /usr/local/bin/bdf_env.sh && \
    echo 'export PATH=$BDFHOME/bin:$BDFHOME/sbin:$PATH' >> /usr/local/bin/bdf_env.sh && \
    echo '' >> /usr/local/bin/bdf_env.sh && \
    echo '# Execute the command' >> /usr/local/bin/bdf_env.sh && \
    echo 'exec "$@"' >> /usr/local/bin/bdf_env.sh && \
    chmod +x /usr/local/bin/bdf_env.sh

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /work

# é»˜è®¤ä½¿ç”¨ç¯å¢ƒè„šæœ¬ä½œä¸ºå…¥å£ç‚¹
ENTRYPOINT ["/usr/local/bin/bdf_env.sh"]
CMD ["/bin/bash"]
```
æ³¨æ„ä¸Šè¿°dockerfileå®Œå…¨æ²¡åšä»»ä½•ä¼˜åŒ–ï¼Œè‚¯å®šä¼šè£…è¿›æ¥å¾ˆå¤šå†—ä½™çš„ä¸œè¥¿ï¼Œåç»­æœ‰æ—¶é—´æˆ‘æ¥ææã€‚å®‰è£…è„šæœ¬ï¼š
```bash
#!/bin/bash
set -e

echo "æ„å»ºBDF Dockeré•œåƒ (åŒ…å«Intel OneAPI)..."

# æ£€æŸ¥å¿…éœ€çš„æ–‡ä»¶å’Œç›®å½•
echo "æ£€æŸ¥å¿…éœ€æ–‡ä»¶..."

if [ ! -d "./bdf" ]; then
    echo "é”™è¯¯: è¯·å…ˆå°†BDFè½¯ä»¶ç›®å½•æ”¾åœ¨å½“å‰ç›®å½•ä¸‹å¹¶å‘½åä¸º 'bdf'"
    echo "ç›®å½•ç»“æ„åº”è¯¥æ˜¯: ./bdf/bin/, ./bdf/lib/, ./bdf/sbin/ ç­‰"
    exit 1
fi

if [ ! -d "./oneapi" ]; then
    echo "é”™è¯¯: è¯·åˆ›å»º './oneapi' ç›®å½•å¹¶æ”¾å…¥Intel OneAPIå®‰è£…åŒ…"
    exit 1
fi

if [ ! -f "./oneapi/l_BaseKit_p_2024.2.1.100_offline.sh" ]; then
    echo "é”™è¯¯: æ‰¾ä¸åˆ° l_BaseKit_p_2024.2.1.100_offline.sh"
    echo "è¯·å°†å…¶æ”¾åœ¨ ./oneapi/ ç›®å½•ä¸‹"
    exit 1
fi

if [ ! -f "./oneapi/l_HPCKit_p_2024.2.1.79_offline.sh" ]; then
    echo "é”™è¯¯: æ‰¾ä¸åˆ° l_HPCKit_p_2024.2.1.79_offline.sh"
    echo "è¯·å°†å…¶æ”¾åœ¨ ./oneapi/ ç›®å½•ä¸‹"
    exit 1
fi

echo "æ‰€æœ‰å¿…éœ€æ–‡ä»¶æ£€æŸ¥é€šè¿‡ï¼"

# æ„å»ºé•œåƒï¼ˆè¿™å¯èƒ½éœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œå› ä¸ºè¦å®‰è£…Intel OneAPIï¼‰
echo "å¼€å§‹æ„å»ºé•œåƒï¼ˆè¿™å¯èƒ½éœ€è¦20-30åˆ†é’Ÿï¼‰..."
docker build -t bdf:oneapi-ubuntu22.04 .

echo "é•œåƒæ„å»ºå®Œæˆï¼"
docker images | grep bdf

```
å®‰è£…å‰ï¼Œéœ€è¦æŠŠbdfç¨‹åºæ–‡ä»¶æ”¾åœ¨å½“å‰ç›®å½•ä¸‹bdfæ–‡ä»¶å¤¹å†…(è¿™ä¸ªåç»­æ‰“ç®—ä¼˜åŒ–æ‰ï¼Œä¸åº”è¯¥æŠŠç¨‹åºåŒ…è¿›å»)ï¼Œoneapiçš„å®‰è£…åŒ…æ”¾è¿›oneapiæ–‡ä»¶å¤¹å†…ã€‚å‡†å¤‡å¥½åï¼Œæ‰§è¡Œï¼š
```
./build_bdf_docker.sh
```
ä¸€æ®µæ—¶é—´åè¿è¡Œå®Œæˆï¼Œå¾—åˆ°BDFé•œåƒï¼š
```
bdf              oneapi-ubuntu22.04   19b19d6fbe96   27 seconds ago   28.2GB
```
28.2GBï¼Œè¿™å°±æ˜¯ä¸åšä¼˜åŒ–çš„åå¤„ğŸ¥²ä¸è¿‡çº¯è‡ªç”¨çš„è¯å€’ä¹Ÿæ˜¯çœ¼ä¸è§å¿ƒä¸çƒ¦ã€‚æµ‹è¯•ï¼š
```
#!/bin/bash
# æµ‹è¯•BDF Dockerç¯å¢ƒ

echo "æµ‹è¯•BDF Dockerç¯å¢ƒ..."

docker run --rm \
    bdf:oneapi-ubuntu22.04 \
    /bin/bash -c "
    echo '=== ç³»ç»Ÿä¿¡æ¯ ==='
    cat /etc/os-release | head -2
    
    echo -e '\n=== GLIBCç‰ˆæœ¬ ==='
    ldd --version | head -1
    
    echo -e '\n=== Intel OneAPIç¯å¢ƒ ==='
    which icc || echo 'ICC not found'
    which ifort || echo 'Intel Fortran not found'
    
    echo -e '\n=== BDFç¯å¢ƒ ==='
    echo 'BDFHOME: $BDFHOME'
    ls -la /apps/bdf/bin/ | head -5
    
    echo -e '\n=== åº“ä¾èµ–æ£€æŸ¥ ==='
    ldd /apps/bdf/bin/compass.x | head -10 || echo 'compass.x not found or has issues'
    
    echo -e '\n=== OpenMPæµ‹è¯• ==='
    echo 'OMP_NUM_THREADS: $OMP_NUM_THREADS'
    "

echo "ç¯å¢ƒæµ‹è¯•å®Œæˆï¼"

```
è¾“å‡ºç±»ä¼¼äºï¼š
```
(obabel) [sun@s01 bdf_docker]$ ./test_bdf_env.sh
æµ‹è¯•BDF Dockerç¯å¢ƒ...
 
:: initializing oneAPI environment ...
   bdf_env.sh: BASH_VERSION = 5.1.16(1)-release
   args: Using "$@" for setvars.sh arguments: --force
:: advisor -- latest
:: ccl -- latest
:: compiler -- latest
:: dal -- latest
:: debugger -- latest
:: dev-utilities -- latest
:: dnnl -- latest
:: dpcpp-ct -- latest
:: dpl -- latest
:: ipp -- latest
:: ippcp -- latest
:: mkl -- latest
:: mpi -- latest
:: tbb -- latest
:: vtune -- latest
:: oneAPI environment initialized ::
 
=== ç³»ç»Ÿä¿¡æ¯ ===
PRETTY_NAME="Ubuntu 22.04.5 LTS"
NAME="Ubuntu"

=== GLIBCç‰ˆæœ¬ ===
ldd (Ubuntu GLIBC 2.35-0ubuntu3.10) 2.35

=== Intel OneAPIç¯å¢ƒ ===
ICC not found
/opt/intel/oneapi/compiler/2024.2/bin/ifort

=== BDFç¯å¢ƒ ===
BDFHOME: 
total 2617876
drwxr-xr-x. 1 bdfuser bdfuser      4096 Jul  1 11:51 .
drwxr-xr-x. 1 bdfuser bdfuser       159 Jul  1 11:51 ..
-rwxr-xr-x. 1 bdfuser bdfuser  95264112 Jul  1 10:27 atom.x
-rwxr-xr-x. 1 bdfuser bdfuser  97220840 Jul  1 10:27 bdfopt.x

=== åº“ä¾èµ–æ£€æŸ¥ ===
        linux-vdso.so.1 (0x00007ffc617fc000)
        libiomp5.so => /opt/intel/oneapi/compiler/2024.2/lib/libiomp5.so (0x00007fbf42000000)
        libimf.so => /opt/intel/oneapi/compiler/2024.2/lib/libimf.so (0x00007fbf41bf4000)
        libm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007fbf424b4000)
        libirng.so => /opt/intel/oneapi/compiler/2024.2/lib/libirng.so (0x00007fbf41afb000)
        libstdc++.so.6 => /lib/x86_64-linux-gnu/libstdc++.so.6 (0x00007fbf418cf000)
        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007fbf416a6000)
        /lib64/ld-linux-x86-64.so.2 (0x00007fbf425a2000)
        libgcc_s.so.1 => /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007fbf42494000)
        librt.so.1 => /lib/x86_64-linux-gnu/librt.so.1 (0x00007fbf4248f000)

=== OpenMPæµ‹è¯• ===
OMP_NUM_THREADS: 
ç¯å¢ƒæµ‹è¯•å®Œæˆï¼
(obabel) [sun@s01 bdf_docker]$
```
å¯ä»¥çœ‹åˆ°å½“å‰çš„ç¯å¢ƒå·²ç»å®Œå…¨å¯ä»¥æ»¡è¶³BDFçš„è¿è¡Œéœ€è¦ã€‚

## è¿è¡ŒBDFè®¡ç®—
ç›´æ¥è®¡ç®—ï¼š
```bash
#!/bin/bash

# ä½¿ç”¨æ–¹æ³•: ./run_bdf_docker.sh input_file.inp [num_threads] [output_file.out]

if [ $# -lt 1 ]; then
    echo "ä½¿ç”¨æ–¹æ³•: $0 input_file.inp [num_threads] [output_file.out]"
    echo "ä¾‹å¦‚: $0 nacme.inp 36 nacme.out"
    exit 1
fi

INPUT_FILE="$1"
NUM_THREADS="${2:-36}"
OUTPUT_FILE="${3:-${INPUT_FILE%.*}.out}"
WORK_DIR=$(pwd)

# æ£€æŸ¥è¾“å…¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
if [ ! -f "$INPUT_FILE" ]; then
    echo "é”™è¯¯: è¾“å…¥æ–‡ä»¶ $INPUT_FILE ä¸å­˜åœ¨"
    exit 1
fi

echo "è¿è¡ŒBDFè®¡ç®—:"
echo "  è¾“å…¥æ–‡ä»¶: $INPUT_FILE"
echo "  è¾“å‡ºæ–‡ä»¶: $OUTPUT_FILE"
echo "  çº¿ç¨‹æ•°: $NUM_THREADS"
echo "  å·¥ä½œç›®å½•: $WORK_DIR"

# åˆ›å»ºä¸´æ—¶ç›®å½•
TMP_DIR="./tmp/$RANDOM"
mkdir -p "$TMP_DIR"

echo "  ä¸´æ—¶ç›®å½•: $TMP_DIR"

# è¿è¡ŒDockerå®¹å™¨
docker run --rm \
    -v "$WORK_DIR":/work \
    -w /work \
    -u $(id -u):$(id -g) \
    --cpus="$NUM_THREADS" \
    -e "BDF_WORKDIR=./" \
    -e "BDF_TMPDIR=$TMP_DIR" \
    -e "OMP_NUM_THREADS=$NUM_THREADS" \
    -e "OMP_STACKSIZE=4G" \
    bdf:oneapi-ubuntu22.04 \
    python3 /apps/bdf/sbin/bdfdrv.py -r "$INPUT_FILE" > "$OUTPUT_FILE"

echo "è®¡ç®—å®Œæˆï¼"
```
é€šè¿‡sgeä½œä¸šç³»ç»Ÿæäº¤ï¼š
```bash
#!/bin/bash
#$ -S /bin/bash
#$ -N bdf_docker
#$ -pe mpi_36 36
#$ -q cpu.q
#$ -cwd
#$ -j y

# SGEç¯å¢ƒä¸‹çš„BDF Dockerä½œä¸šè„šæœ¬
# ä½¿ç”¨æ–¹æ³•: qsub bdf_sge_docker.sh input_file.inp

INPUT_FILE="$1"
OUTPUT_FILE="${INPUT_FILE%.*}.out"
ERROR_FILE="${INPUT_FILE%.*}.e"

if [ -z "$INPUT_FILE" ]; then
    echo "é”™è¯¯: è¯·æä¾›è¾“å…¥æ–‡ä»¶å"
    echo "ä½¿ç”¨æ–¹æ³•: qsub $0 input_file.inp"
    exit 1
fi

echo "=== BDF Docker ä½œä¸šå¼€å§‹ ==="
echo "èŠ‚ç‚¹: $(hostname)"
echo "ä½œä¸šID: $JOB_ID"
echo "è¾“å…¥æ–‡ä»¶: $INPUT_FILE"
echo "è¾“å‡ºæ–‡ä»¶: $OUTPUT_FILE"
echo "é”™è¯¯æ–‡ä»¶: $ERROR_FILE"
echo "å·¥ä½œç›®å½•: $(pwd)"
echo "åˆ†é…çš„æ ¸å¿ƒæ•°: $NSLOTS"
echo "å¼€å§‹æ—¶é—´: $(date)"

# è®¾ç½®unlimited limits (åœ¨å®¹å™¨å†…)
# ulimit -s unlimited
# ulimit -l unlimited

# åˆ›å»ºä¸´æ—¶ç›®å½•
TMP_DIR="./tmp/$RANDOM"
mkdir -p "$TMP_DIR"

echo "ä¸´æ—¶ç›®å½•: $TMP_DIR"

# è¿è¡ŒBDFè®¡ç®—
docker run --rm \
    -v "$(pwd)":/work \
    -w /work \
    -u $(id -u):$(id -g) \
    --cpus="$NSLOTS" \
    --ulimit memlock=-1:-1 \
    --ulimit stack=-1:-1 \
    -e "BDF_WORKDIR=./" \
    -e "BDF_TMPDIR=$TMP_DIR" \
    -e "OMP_NUM_THREADS=$NSLOTS" \
    -e "OMP_STACKSIZE=4G" \
    bdf:oneapi-ubuntu22.04 \
    python3 /apps/bdf/sbin/bdfdrv.py -r "$INPUT_FILE" > "$OUTPUT_FILE" 2> "$ERROR_FILE"

EXIT_CODE=$?

echo "ç»“æŸæ—¶é—´: $(date)"
echo "é€€å‡ºä»£ç : $EXIT_CODE"
echo "=== BDF Docker ä½œä¸šå®Œæˆ ==="

exit $EXIT_CODE
```
è°ƒè¯•ï¼š
```bash
#!/bin/bash
# å¯åŠ¨äº¤äº’å¼BDFå®¹å™¨ï¼Œç”¨äºè°ƒè¯•

WORK_DIR=$(pwd)
NUM_THREADS="${1:-4}"

echo "å¯åŠ¨BDFäº¤äº’å¼å®¹å™¨..."
echo "å·¥ä½œç›®å½•: $WORK_DIR"
echo "çº¿ç¨‹æ•°: $NUM_THREADS"

docker run -it --rm \
    -v "$WORK_DIR":/work \
    -w /work \
    -u $(id -u):$(id -g) \
    --cpus="$NUM_THREADS" \
    -e "OMP_NUM_THREADS=$NUM_THREADS" \
    -e "OMP_STACKSIZE=4G" \
    bdf:oneapi-ubuntu22.04 \
    /bin/bash

```
ç¬”è€…æµ‹è¯•äº†ç¬¬äºŒç§æ–¹å¼ï¼Œå…ˆå‰æ— æ³•æ­£å¸¸è¿è¡Œçš„BDFè®¡ç®—æ­¤æ—¶å·²ç»å¯ä»¥æ­£å¸¸ç»“æŸï¼š
```
 ---------------------------------------------------------------
  Timing of RESP_PROPS calculation                                                
 
  CPU TIME(S)      SYSTEM TIME(S)     WALL TIME(S)
        538.570            3.540              15.140
 ---------------------------------------------------------------
 
|******************************************************************************|
 
    Total cpu     time:        538.57  S
    Total system  time:          3.54  S
    Total wall    time:         15.14  S
 
    Current time   2025-08-01  14:01:01
    End running module resp
|******************************************************************************|
 
Total wall time          22.58 Seconds
You should check your OUTFILE name, neither .bdflog or .bdfout!
/apps/bdf/sbin/bdfsummary.py\bdf_summary\\gb3lyp/DEF2-SVP\\0,1\\C,0.0000004475,4.7804610199,-0.0000026894\C,-2.4071403222,3.6619171642,0.0000114899\C,-3.0278682803,1.0441514135,0.0000182002\C,2.4071410728,3.6619168536,-0.0000126720\C,-1.3891243743,-1.0290332084,0.0000102948\C,3.0278668032,1.0441529126,-0.0000171592\C,1.3891207402,-1.0290296082,-0.0000214317\H,0.0000005812,6.8499076578,-0.0000051068\H,-4.0114251220,4.9633073991,0.0000141138\H,-5.0457405426,0.5931702938,0.0000164802\H,4.0114260405,4.9633106609,-0.0000116930\H,5.0457371173,0.5931658633,-0.0000065842\C,-2.1735422984,-3.6504498994,-0.0000193770\H,-4.1298170597,-4.2920401384,-0.0000366291\C,0.0000016945,-5.1885793906,-0.0000243688\H,0.0000015618,-7.2491556541,-0.0000370634\C,2.1735439939,-3.6504464005,0.0000539224\H,4.1298205617,-4.2920312227,0.0000892272\\gb3lyp=GEOM\\
Congratulations! BDF normal termination
./tmp/21315 /work
 Warning! Removing scratch files. If you would like to keep scratch files for restaring. Please use -keeptmpdir
```

