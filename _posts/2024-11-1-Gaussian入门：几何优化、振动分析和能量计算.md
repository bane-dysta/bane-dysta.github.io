---
title: Gaussian入门：几何优化、振动分析和能量计算
date: 2024-11-1 12:00:00 +0800
categories: [Calculation, Quantum Chemistry]
tags: [Gaussian]     
---
Gaussian是最流行的量子化学计算软件，功能涵盖了绝大部分常规任务。且Gaussian的输入文件绝对是所有主流量子化程序中最简洁的，这一点笔者在学过ORCA、Dalton、NMChem等软件后深有体会。因此，Gaussian是入门量子化学应当首先掌握的软件。而几何优化又是所有任务中最基础的任务，绝大多数量子化学计算都要基于几何优化后的结构来进行。总之，这是一个入门级的几何优化教程贴。
# 0. 软件安装
安装包各位八仙过海各显神通，笔者这里就不提供了。

Windows下安装Gaussian，只要跟着安装程序走就行。需要注意的问题有：
- 由于笔者是做荧光的，相信来看笔者blog的也是对计算激发态有需求的，那么**强烈建议安装Gaussian 16以及配套的GaussView 6**，而非Gaussian 09和GaussView 5。因为G09不支持TDDFT的二阶解析梯度，做激发态优化时若要进行频率分析，则必须使用数值梯度，纯属自找麻烦。
- 一定要找64位Gaussian的安装包，不要32位的。
- 要先安装Gaussian 16，再安装GaussView 6，并把GaussView 6安装在Gaussian 16的文件夹内。
- 不建议安装在C盘。
- **安装路径一定要避免中文或空格，且尽量避免除了"-"和"_"以外的特殊字符。**
- 不要乱改G16创建的主文件夹的名称，想自定义可以建立一个上级文件夹，把Gaussian安装在里面。
- 安装完毕后，打开G16W检查有没有scratch路径，若没有可以手动建立。
Linux版Gaussian是预编译版本，只需要使用``tar -xvf name.tar``将压缩包解压到一处，然后设置环境变量：
~~~bash
echo 'export g16root=/path/to/g16' >> ~/.bashrc
echo 'export GAUSS_SCRDIR=/path/to/g16/scratch' >> ~/.bashrc
echo 'source /path/to/g16/bsd/g16.profile' >> ~/.bashrc
~~~
注意将/path/to/g16替换为你的实际解压路径。最后在g16目录下输入``chmod 750 -R *``加上可执行权限，Gaussian就安装完毕了。
# 1. 搭建结构
我们平时看的lewis式或键线式都是2D结构，不包含3D信息。因此需要首先将其转换成相对合理的3D坐标，才能拿给程序去计算。以下是一些转换方法。
## 1.1 使用Chem Office套件转换
能看到这的人应该不用我教ChemDraw了，如果你不会，请关闭此网站并认真完成今天的家庭作业。在ChemDraw上画好2D结构后，``Ctrl+C``复制，打开Chem3D，然后``Ctrl+V``粘贴，就得到了一个3D结构。如果你的电脑还行，可以使用``Ctrl+M``进行MM2初步优化，得到一个相对合理一些的结构。完成后，使用``Ctrl+Shift+S``另存为Gaussian Input文件，在后缀名下拉菜单里找到gjf并保存。
> 注意：如果你使用了MM2优化，你还需要以记事本格式打开产生的gjf文件，查找以"Lp"开头的行并将其全部删掉。

## 1.2 使用GaussView搭建结构
这个笔者自己也用不太明白，暂时略过，以后看心情补。GaussView的好处是可以自己调整立体结构，比Chem3D灵活得多，且很适合用点群工具搭建对称性体系，但是笔者已经太习惯ChemDraw延申碳碳键的方式了，换GaussView很不适应。
## 1.3 使用OpenBabel转换smiles字符串
有些网站可以提供smiles字符串，可以使用OpenBabel将其转换为3D结构，适合写批量转换脚本，有一定命令行基础的读者可以尝试。去[OpenBabel官网](https://openbabel.org/docs/Installation/install.html)下载并安装好OpenBabel后，在命令行中运行``obabel -:"CCO" -O name.gjf --gen3d``即可生成gjf文件。

注意这里生成的的gjf文件没有title行，也没有计算参数，得手动补上。
## 1.4 从数据库中下载
很多已知的分子可以从一些化学数据库，如[PubChem](https://pubchem.ncbi.nlm.nih.gov/)上找到现成的3D结构。然而，直接下载下来的是sdf格式，可以用OpenBabel命令``obabel name.sdf -O name.gjf``将其转换为gjf格式。
# 2. 输入文件准备
刚刚拿到的输入文件只有几何信息，没有计算相关信息，还需要告诉程序计算相关的设置才能开始计算。Gaussian输入文件的格式为：
```
%mem=96gb                           //分配内存
%nproc=32                           //分配CPU核心数
%chk=name.chk                       //chk文件保存路径
# opt freq B3LYP/6-31g* em=gd3bj    //关键词行

title                               //title行

 0 1                                //电荷与自旋多重度
 O                  0.59045900    2.54746200   -0.38465600
 H                  0.75827400    3.49135900   -0.40503900
 ···
 H                  1.45116700    2.10109600   -0.24694300

                                    //末尾留空两行
```
## 2.1 电荷与自旋多重度
虽然几何结构已经有了，但是程序自动给出的电荷和自旋不一定是对的，需要手动检查。

电荷就是体系的总电荷数，这个不必多说。

自旋多重度是``α电子数-β电子数+1``，这个解释起来稍微麻烦一些，可以姑且认为常见有机体系自旋均为1。但是如果涉及自由基、金属、卡宾、氧气等情况，就另当别论了。可以参考这个[帖子](http://bbs.keinsci.com/thread-4836-1-1.html)里的讨论。
## 2.2 基组的选择
基组是描述电子在空间中分布的基函数集，用来近似表示分子体系中电子的波函数。如果想要完美描述电子的分布，所需要的代价太大，因此实际计上常常使用尺寸小一些的基组进行计算。

价电子是最活跃的电子，其参与了大多数的化学键和分子间相互作用。为了更精确地描述价电子的行为，实际常常用多组基函数描述价层，称为基组的分裂价ζ。如果用两组基函数描述价层，则称为2-ζ基组，如果用三组基函数描述价层，则称为3-ζ基组。分裂价越高，基组尺寸越大，计算代价也越大。但如果选择的基组分裂价太低，则精确性会受到严重影响。因此，适当选用基组是很重要的。

常用基组系列有：
- pople系列基组：如6-31g、6-311g等
- Ahlrichs系列基组：如def-TZVP、def2-SVP等
- Dunning's相关一致性基组：如cc-pVTZ、cc-pVQZ等

其中，DFT常用基组是前两个系列的，而Dunning's相关一致性基组是给post-HF计算设计的，并不适合DFT计算。

除了分裂价，还有两个地方值得注意：
- 极化函数。添加极化函数表示给原子添加一个更高角动量的轨道，允许电子在不同方向更灵活地分布。通常重原子和氢原子的极化是可以分开加的。
- 弥散函数。添加弥散函数表示给原子添加一个衰减指数较小的基函数，来描述远离原子核的电子分布。通常重原子和氢原子的弥散也是可以分开加的。

具体基组怎么选择、弥散函数和极化函数做什么任务的时候要加、怎么加的问题很复杂。简单来说：
- **几何优化和频率分析用2-ζ基组就行**，单独计算能量可以用3-ζ或4-ζ基组；
- **重原子极化一定要加**，而氢原子极化在计算直接与氢相关的问题才必须加；
- 重原子弥散在算阴离子能量时等特殊情况需要加，而**氢原子弥散几乎不用考虑**。

更详细的说明可以参考[sobevera老师的博文](http://sobereva.com/336)。这里给出常用基组尺寸的大致排序和建议：
```
6-31G* < def2-SVP ≈ 6-31G** << 6-311G** < def-TZVP < def2-TZVP << def2-QZVP
 2-ζ                             3-ζ                几何优化封顶      4-ζ
```
- 前四周期体系的几何优化和振动分析用6-31g*即可，如果体系中有第五周期以上的元素，需要改用def2-SVP。
- 基于优化好的几何结构计算单点能时可以使用def2-TZVP，计算阴离子能量等时需要加弥散函数，可以使用6-311+g**或ma-TZVP(需要自己引用基组定义)。
## 2.3 泛函的选择
密度泛函是基于Kohn-Shan方程，用于计算体系电子相关能量的数学表达式，核心思想是通过电子密度来确定体系的能量，而不是直接处理多电子波函数。密度泛函是一种映射关系，将电子密度映射到体系的能量上，因此不同的泛函会影响到计算结果的精确度。

由于DFT理论对电子库伦相关与交换作用描述并不充分，可以引入Hartree-Fock相关项与MP2交换项来改进计算结果。引入Hartree-Fock相关项的泛函称为杂化泛函，同时引入Hartree-Fock相关项与MP2交换项的泛函称为双杂化泛函。

泛函的选择也很复杂，同样可以参考[sobevera老师的博文](http://sobereva.com/272)。这里也给出大致的建议：
- 纯泛函：一般任务不建议使用，会高估电子离域性，且低估激发能。对于ORCA用户，可以尝试基于纯泛函B97引入多项校正的B97-3c，比较便宜。
- 杂化泛函：基态非共轭体系几何优化和振动分析推荐B3LYP，大共轭体系推荐ωB97XD、cam-B3LYP；LE激发推荐PBE0，CT激发推荐ωB97XD、cam-B3LYP；计算主族体系能量推荐M06-2X；计算核磁推荐revTPSS；对于ORCA用户，还推荐使用ωB97M-V计算高精度能量。
- 双杂化泛函：仅建议计算能量时使用。Gaussian对B2PLYP-D3的支持比较好，仍然可以使用；DSD-PBEP86-D3(BJ)可以用来计算激发态；对于ORCA用户，PWPB95-D3(BJ)是比较稳健的选择。

## 2.4 计算关键词
在gjf文件中，是控制量子化学计算内容的核心部分，包含了计算任务、计算方法、计算参数等所有计算相关的选项。书写规则：
- 位于核数、内存、检查点文件设置之后，位于title行之前
- 以"#"开头，关键词之间用空格分隔，且不区分大小写、不区分顺序
- 在不会引起歧义的前提下，可以进行省略。如opt=ModRedundant可简写为opt=modr，因为opt的参数中以"modr"开头的只有ModRedundant。
- 由于结构优化和频率分析的计算级别需要严格一致，多数量化程序都支持结构优化和频率分析合并成一个任务。但除这两个可以一起做以外，其他的计算任务关键词不能写在一起。

首先应当明确的是计算任务。结构优化的关键词为``opt``，振动分析的关键词是``freq``，能量的关键词是``sp``或留空。如前所述，几何优化和频率分析一般是一起做的，可以写``opt freq``。

然后是计算水平。基组和泛函在程序里的关键词不一定与方法名相同，需要查阅Gaussian的[泛函手册](https://gaussian.com/dft/)和[基组手册](https://gaussian.com/basissets/)获取正确的关键词。有的泛函和基组名和关键词差别很大，如PBE0的关键词是``PBE1PBE``，def-TZVP的关键词是``TZVP``，不看手册根本猜不到的。

定下任务，选好泛函和基组之后，关键词行剩下的就是些边边角角的琐碎选择了。
- D3色散校正：由于泛函对色散行为描述很差而引入的一个校正项，计算弱相互作用体系时需要添加。**如果不确定体系有没有弱相互作用，可以总是添加D3校正，尤其是对于B3LYP**。D3校正号称计算器手算都能算出来，耗时可以忽略不计。
  >注意不同泛函对D3校正的支持情况不同，B3LYP支持BJ阻尼形式的色散校正``em=gd3bj``，而M06-2X只支持0阻尼形式的色散校正``em=gd3``，ωB97XD则自带D2色散校正，不用额外添加。
- 溶剂模型：使用``scrf=(solvent=water)``来添加隐式溶剂，默认模型为IEFPCM。在计算能量时，可以切换为SMD溶剂模型，更好地描述非极性部分。Gaussian的[溶剂手册](https://gaussian.com/scrf/)列出了Gaussian支持的溶剂与对应的关键词。
## 2.5 计算资源分配
通常来说，核数按照(计算机物理核心数-2)来给即可，而内存最好每个核分配2-3gb，最少每个核要1gb，不然会拖慢计算速度。

为了提供一些参考，假设配置为12核，内存24GB，计算级别选择B3LYP/6-31g*，这样算小型体系是算的动的，而中型体系就有些吃力了，较大体系基本没戏。笔者平时计算惯用配置是32核+96gb，用比较好的级别如``wb97XD/TZVP``计算中型体系也没什么问题，而较大体系换小级别也能应付一下。

一般chk文件就保存在当前目录即可。注意linux版Gaussian输入文件的chk行可以不写绝对路径。

# 3. 提交计算与分析结果 
windows提交计算可以直接把gjf拖进Gaussian程序，然后点开始；linux版Gaussian需要命令行启动，命令为：
```
g16 name.gjf > name.log
```
当计算结束时，log文件末尾会打印类似于这样的输出：
```
Normal termination of Gaussian 16 at Fri Nov  1 18:40:19 2024.
```
此时就可以用GaussView打开log文件或者out文件查看结果了。

对于做了opt+freq的任务，要判断几何结构是否真正收敛到了势能面极小点，可以在右键菜单中找到Results - Vibration，检查最上面有没有频率值为负数的虚频。如果没有虚频，说明当前几何结构确实是能量最低结构。而如果存在虚频，则说明当前结构处于势能面上的鞍点，没有收敛到真正的极小点。这种情况下，还需要将log文件``Ctrl+S``保存为gjf文件，更改计算设置后重新进行一次几何计算。推荐尝试``opt=calcfc``。

对于计算时遇到的报错问题，可以在这个[帖子](http://bbs.keinsci.com/thread-4829-1-1.html)里查找解决办法，或按照帖子所述提取关键信息发到论坛或者群里求助别人。


