---
title: ä¸ºLinuxæœåŠ¡å™¨å®‰è£…SMBæœåŠ¡
date: 2025-4-25 12:00:00 +0800
categories: [software]
tags: [software]   
---
æœ€è¿‘ç¬”è€…ç»„é‡Œæ–°æ·»äº†æœåŠ¡å™¨ã€‚ç”±äºç»„é‡Œæ²¡äººä¼šç©ï¼Œå¯ä»¥æ„‰å¿«åœ°è¿›è¡ŒçæğŸ˜¸

ç”±äºç¬”è€…å…ˆå‰å·²ç»ç”¨NASçˆ½è¿‡SMBæœåŠ¡ï¼Œä¸ºäº†~~æè‡´å·æ‡’~~å……åˆ†å‘æŒ¥å±€åŸŸç½‘çš„ä¼˜åŠ¿ï¼Œç¬”è€…å†³å®šç»™æœåŠ¡å™¨ä¹Ÿè£…ä¸Šï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æœ¬åœ°æ“ä½œè®¡ç®—æ–‡ä»¶ï¼Œè€Œä¸å¿…sshè¿è¿‡å»ï¼Œå†ä¸‹è½½åˆ°æœ¬åœ°ï¼Œå†ä¼ å›å»äº†ã€‚

## Linuxç«¯é…ç½®

### å®‰è£…SAMBAè½¯ä»¶
ç¬”è€…çš„æœåŠ¡å™¨æ˜¯Rocky8.10ï¼Œä½¿ç”¨dnfå®‰è£…ï¼š
```bash
sudo dnf install samba samba-common samba-client
```
è£…å¥½åï¼Œå¤‡ä»½é…ç½®æ–‡ä»¶ï¼š
```bash
sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.bak
sudo vi /etc/samba/smb.conf
```
æˆ‘ä»¬åªéœ€è¦æŒ‚è½½è®¡ç®—ç›®å½•ã€‚ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š
```conf
[global]
   workgroup = WORKGROUP
   security = user
   map to guest = Never
   
[{share_name}]
   path = {path}
   valid users = {user}
   writeable = yes
   create mask = 0664
   directory mask = 0775
   force user = {user}
   force group = {user}
```
å…¶ä¸­ï¼š
- {share_name}æ˜¯åˆ†äº«åç§°ï¼›
- {path}æ˜¯è®¡ç®—æ–‡ä»¶å¤¹ï¼Œä¹Ÿæ˜¯è¦å…±äº«å‡ºå»çš„è·¯å¾„ï¼›
- {user}æ˜¯ä½ çš„ç”¨æˆ·ã€‚

è®°ä½è¿™ä¸‰ä¸ªå˜é‡ï¼Œåç»­ä¼šåå¤æåŠã€‚

å¦å¤–ï¼Œè¿˜éœ€è¦ä¸ºSMBç™»å½•ç”¨æˆ·{user}è®¾ç½®SMBå¯†ç ï¼š
```
sudo smbpasswd -a {user}
```

> æ³¨æ„ï¼Œè¿™å¹¶ä¸æ˜¯æ ‡å‡†çš„SMBé…ç½®ã€‚å¯¹äºå…¬ç”¨çš„æœåŠ¡å™¨ï¼Œé€šå¸¸éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šå»ºç«‹ä¸€ä¸ªä¸“é—¨ç”¨äºè®¿é—®SambaæœåŠ¡çš„è´¦æˆ·ï¼Œå¹¶é™åˆ¶æƒé™ï¼Œé¿å…ä¸€äº›å®‰å…¨é£é™©ã€‚ç¬”è€…è¿™è¾¹ä¸€æ˜¯è‡ªç”¨ä¸”å¹¶ä¸åœ¨å…¬ç½‘æœåŠ¡ï¼ŒäºŒæ˜¯éœ€è¦è”åŠ¨ä¸€äº›è®¡ç®—ç›¸å…³å¥—ä»¶ï¼Œå°±æ²¡é‚£ä¹ˆè®²ç©¶
{: .prompt-info }

### å¼€å¯æœåŠ¡
ä¸ºSELinuxè®¾ç½®ä¸Šä¸‹æ–‡ï¼š
```bash
sudo setsebool -P samba_enable_home_dirs on
sudo setsebool -P samba_export_all_rw on
sudo semanage fcontext -a -t samba_share_t "{path}(/.*)?"
sudo restorecon -Rv {path}
```

å…è®¸SMBæœåŠ¡é€šè¿‡é˜²ç«å¢™ï¼š
```bash
sudo firewall-cmd --permanent --add-service=samba
sudo firewall-cmd --reload
```

å¼€å¯systemctlæœåŠ¡ï¼š
```bash
sudo systemctl enable smb nmb
sudo systemctl start smb nmb
```

æ£€æŸ¥çŠ¶æ€ï¼š
```
sudo systemctl status smb
```

åˆ°è¿™é‡Œï¼Œç†è®ºä¸Šå°±å¯ä»¥ä½¿ç”¨äº†ã€‚

## Windowsç«¯é…ç½®

### è¿æ¥

åœ¨Windowsèµ„æºç®¡ç†å™¨æ‰“å¼€`æ­¤ç”µè„‘`ç•Œé¢ï¼Œä»ä¸Šæ–¹å·¥å…·æ æ‰¾åˆ°å±•å¼€æŒ‰é’®``Â·Â·Â·``ï¼Œç‚¹å‡»ååœ¨å¼¹å‡ºçš„èœå•é‡Œé€‰æ‹©`æ˜ å°„ç½‘ç»œé©±åŠ¨å™¨`

![](https://pub-ec46b9a843f44891acf04d27fddf97e0.r2.dev/2025/04/20250425164009.png)

ç›˜ç¬¦å¯ä»¥è‡ªå·±æŒ‘å–œæ¬¢çš„ï¼Œæ–‡ä»¶å¤¹éœ€è¦è¾“å…¥:
```
\\{linuxæœåŠ¡å™¨çš„ip}\{share_name}
```
ç‚¹å‡»å®Œæˆï¼Œå¼¹å‡ºä¸€ä¸ªç™»å½•å‡­æ®è¾“å…¥ç•Œé¢ï¼Œç¬”è€…è¿™é‡Œæ²¡æœ‰æˆªå›¾äº†ã€‚åœ¨è¿™é‡Œéœ€è¦è¾“å…¥{user}å’Œä¹‹å‰è®¾ç½®çš„SMBå¯†ç ï¼Œå¯ä»¥å‹¾é€‰è®°ä½å‡­æ®ï¼Œä»¥åå°±ä¸ç”¨å†è¾“å…¥äº†ã€‚

å®Œæˆåï¼Œç‚¹å‡»è¿æ¥ï¼Œåº”å½“ä¼šå¼¹å‡ºç½‘ç»œä½ç½®æ–‡ä»¶å¤¹ï¼Œè¡¨ç¤ºwindowså·²ç»æˆåŠŸå°†{path}æ˜ å°„æˆä¸€ä¸ªæœ¬åœ°é©±åŠ¨å™¨ï¼Œå¯ä»¥è‡ªç”±æ“ä½œäº†ã€‚

### tricks
ç”±äºç¬”è€…æ˜¯ç¬”è®°æœ¬ç”µè„‘ï¼Œæœ‰æ—¶éœ€è¦ç¦»å¼€å±€åŸŸç½‘ç¯å¢ƒï¼Œæ­¤æ—¶å¤±å»ç½‘ç»œè¿æ¥çš„æ˜ å°„ç›˜ç¬¦ä¼šå˜ä¸ºå¤±æ•ˆçŠ¶æ€ã€‚

å‡è£…æœ‰å›¾

å¦‚æœåªæ˜¯å¤±æ•ˆä¹Ÿæ— æ‰€è°“äº†ï¼Œéº»çƒ¦çš„æ˜¯å¦‚æœåœ¨æ‹–åŠ¨æ–‡ä»¶æ—¶ä¸å°å¿ƒç»è¿‡äº†è¿™ä¸ªç›˜ç¬¦ï¼Œèµ„æºç®¡ç†å™¨å°±ä¼šå¡ä¸€ä¼šï¼Œä¼°è®¡æ˜¯è¯•å›¾è®¡ç®—æŠŠè¿™ä¸ªæ–‡ä»¶æ‹–åŠ¨åˆ°ä¸Šé¢æ¾å¼€ä¼šå‘ç”Ÿä»€ä¹ˆã€‚è™½ç„¶è§¦å‘æ¦‚ç‡ä¸é«˜ï¼Œä½†æ˜¯ä¸€æ—¦è§¦å‘ï¼Œä½“éªŒå·®çš„ä¸€æ‰¹ã€‚

è·ŸClaudeå•†é‡ä¸€ç•ªåï¼Œç¬”è€…å‘ç°å¯ä»¥ç”¨æ‰¹å¤„ç†è„šæœ¬åˆ‡æ¢ç½‘ç»œé©±åŠ¨å™¨è¿æ¥çŠ¶æ€ï¼š
```bat
@echo off
setlocal enabledelayedexpansion

set DRIVE=W:
set SHARE=\\{linuxæœåŠ¡å™¨çš„ip}\{share_name}

REM Check if drive is already mounted
net use | find "%DRIVE%" > nul
if %errorlevel% equ 0 (
    echo Drive %DRIVE% is already mounted, disconnecting...
    net use %DRIVE% /delete
    if %errorlevel% equ 0 (
        echo Drive %DRIVE% has been successfully disconnected.
    ) else (
        echo Error disconnecting %DRIVE%.
    )
) else (
    echo Drive %DRIVE% is not mounted, connecting...
    net use %DRIVE% %SHARE%
    if %errorlevel% equ 0 (
        echo Drive %DRIVE% has been successfully mounted to %SHARE%.
    ) else (
        echo Error mounting %SHARE% to %DRIVE%.
    )
)

pause
```
è¿™ä¸ªè„šæœ¬è¿è¡Œæ—¶ä¼šå…ˆæ£€æŸ¥æŒ‚è½½çŠ¶æ€ï¼Œå¦‚æœæ˜¯å·²æŒ‚è½½ï¼Œå°±æ–­å¼€è¿æ¥ï¼›å¦‚æœæœªæŒ‚è½½ï¼Œå°±å°è¯•è¿æ¥ã€‚ä½¿ç”¨è¯¥è„šæœ¬å°±å¯ä»¥å¿«é€Ÿåˆ‡æ¢æŒ‚è½½çŠ¶æ€äº†ã€‚

